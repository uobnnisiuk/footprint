# Behavior Spec (SSOT) — 抽象挙動仕様

この文書は、探索・閲覧・通知に関する**抽象挙動仕様**のSSOTである。
実装・数値粒度・スキーマ確定は含めない。

---

## 0. 前提（問題設定）

- **密**（都心部・電車内など）では痕跡が過多になり、単純な一覧表示や自動フィルタは破綻/取りこぼしに繋がる。
- **疎**（山道など）では、通りすがりの第三者とのすれ違いが「最終位置の手がかり」になり得る。
- 第三者は善意/敵対（空き巣等）を観測だけで判別できないため、**判別ロジックで解こうとせず能力設計で安全性を作る**。

---

## 1. 基本設計原則（抽象挙動）

### 1.1 探索を2系統に分離する

| 系統 | 行為 | 説明 |
|------|------|------|
| **relay（中継）** | 痕跡/遭遇情報を「運ぶ」 | 第三者（通りすがり）でも可能 |
| **reveal（詳細閲覧）** | 痕跡の詳細を「読む」 | 敵対の道具化ポイントなので制御対象 |

**ポイント**: "拾える/運べる"と"読める"を分離する。

#### relay / reveal の境界定義（DEC-0003: IF-BOUNDARY-001）

境界は **sealed payload の復号の有無** で定義する。

- **relay（通知なし）**
  - できること: 受領・保存・再送・重複排除（envelope_id）・チャンク/圧縮（復号なしのまま）・署名の形式検査（任意）
  - 禁止: sealed payload の復号、payload_events（Core Event）の読み取り/解析、そこから導ける位置/時刻/同一性の推定
- **reveal（必ず通知が成立できることが前提）**
  - sealed payload を復号する/平文を見る/平文由来の情報を表示・検索に使う行為はすべて reveal
  - IF-REVEAL-001（サイレント不可）および IF-NOTIFIED-001（送達キュー永続登録）の制約に乗る

### 1.2 "寄り分け"は「除外」ではなく「整理」

- 自動処理は原則として **順位付け・集約・畳み込みまで**。
- 「候補を消す（自動除外）」に寄せない（取りこぼし懸念のため）。

※オープン探索の「最小公開候補スキーマ」は **非決定**（OPEN-001）。

---

## 2. 能力表（Actor × Capability）

現時点で合意した能力（許可/禁止/条件付き）を固定する。

| Actor | 遭遇を拾う (relay) | 通報する (help) | 詳細を見る (reveal) | 同一人物として追う (link) | 証跡を見る (audit) |
|-------|-------------------|-----------------|---------------------|--------------------------|-------------------|
| 通りすがり | 許可（自動OK） | 許可（任意操作） | 禁止 | 禁止 | 禁止 |
| 信頼者（家族等） | 許可（自動OK） | 許可（任意操作） | 許可（通知付き） | 条件付き許可 | 禁止 |
| 権限救助者（Authorized Rescue） | 許可（自動OK） | 許可（任意操作） | 許可（通知＋証跡必須） | 条件付き許可（目的限定） | 許可（監査目的のみ） |
| 監査者（Auditor） | 禁止 | 禁止 | 禁止（原則） | 禁止 | 許可（監査専用） |

### 未決定（OPEN）

- ~~OPEN-009: link（同一人物追跡）の「条件付き」の条件（信頼者・権限救助者それぞれ）~~ → 2.1 で解決
- **OPEN-010**: 権限救助者（Authorized Rescue）の定義（組織・運用主体）

---

## 2.1 link（同一人物追跡）の条件

link は「同意（Consent）」と「非常時根拠（Emergency Justification）」の二系統に分ける。

### Consent-link（信頼者向け）

信頼者（家族等）が link を行うには、以下の全てを満たす必要がある。

| ID | 条件 | 説明 |
|----|------|------|
| CL-Trusted-01 | **本人の事前同意** | 本人が平時に「この信頼者に link を許す」を明示している（期間／用途／緊急時のみ等の範囲指定を含む） |
| CL-Trusted-02 | **通知＋証跡** | link の開始・継続は通知対象（本人＋プラットフォーム）であり、Notified が成立すること（reveal と同じ原則） |
| CL-Trusted-03 | **最小化** | link は「最後の確認点の連鎖」など救助に必要な最小に限定（精密な軌跡は出さない） |

**重要**: 事前同意がない link はゼロ。同意なしは link を許さない。

### Emergency-link（権限救助者向け）

権限救助者（Authorized Rescue）が link を行うには、以下の全てを満たす必要がある。

| ID | 条件 | 説明 |
|----|------|------|
| EL-Rescue-01 | **救助目的の限定** | link の目的が「行方不明/救助」に限定される（調査・治安・興味本位は禁止） |
| EL-Rescue-02 | **発動トリガが客観** | 下記 T2 または T3 のいずれかを満たす（T1 は緩和要因であり必須ではない） |
| EL-Rescue-03 | **通知＋証跡は必須** | link 開始・継続は通知対象（本人＋プラットフォーム）。Notified が成立できないなら link も不可 |
| EL-Rescue-04 | **二者承認 or 監査強度** | 権限救助者の中でも2名（または2システム）承認で link 有効、または発動時点で自動的に監査対象としてフラグされる |
| EL-Rescue-05 | **時間・範囲の自動失効** | link はデフォルトで短時間のTTLが付き、延長には再承認が必要（"ずっと追える"を作らない） |

#### EL-Rescue-02 発動トリガ詳細

| トリガ | 内容 | 備考 |
|--------|------|------|
| **T2: 通報/捜索起点** | • 信頼者からの捜索依頼（家族等の申請）<br>• 第三者による help（通報）起点<br>• 行方不明扱いの登録（運用側での受付） | **孤立者・設定なしでも成立する主ルート** |
| **T3: 災害モード** | • エリアが災害対応モードに入っている（自治体/救助活動の開始等、運用上の"災害状態"） | **密/疎どちらにも効く主ルート** |
| T1: 本人発SOS | • 本人端末/タグが緊急状態を示す | **必須ではない**。存在する場合は緩和要因として機能 |

#### T2 の詳細仕様（通報/捜索起点）

T2 は「運用受付（プラットフォーム受付）を必須のゲート」とし、入力チャネルとして「信頼者申請」「第三者通報」の両方を許す。ただし第三者通報は"link起動"ではなく"受付起票（候補生成）"までに止める。

##### T2 の3段階

| 段階 | 名称 | 内容 |
|------|------|------|
| (1) | **Report（通報/申請）** | だれかが「疑い」を上げる |
| (2) | **Open Case（受付起票）** | 運用受付がケースを作る（監査・追跡の起点） |
| (3) | **Start Link（link開始）** | 権限救助者がlinkを開始する（最も厳格） |

##### Actor 別の権限

| Actor | Report (1) | Open Case (2) | Start Link (3) |
|-------|------------|---------------|----------------|
| 信頼者 | ✅ 可 | → 受付へ | 条件次第で可（受付経由） |
| 第三者 | ✅ 可 | → 受付へ | ❌ 不可（候補化まで） |
| 運用受付 | — | ✅ 可 | 判断して起動 |
| 権限救助者 | — | — | ✅ 可（受付承認後） |

##### 設計根拠

1. **孤立者救助の入口を残せる**: 第三者通報は「家族がいない/連絡先がない」ケースの唯一の入口になり得る
2. **敵対の道具化を抑えられる**: 「第三者通報だけでlinkは起動できない」にすると、空き巣等の旨味が落ちる。受付を挟むことで、濫用を監査・レート制限・審査に寄せられる
3. **既存の通知/証跡原則と整合**: 受付があれば、証跡の起点も一本化できる

##### 残る痛点（OPEN）

- **プラットフォーム不在/通信断**のとき T2 が詰まる
- → T3（災害モード）や、オフライン relay による"後で受付"で補う設計余地が必要（OPEN-012）

#### 第三者通報の最低限情報（抽象要件）

第三者通報（T2: Report）が最低限含むべき情報を抽象要件として固定する。

##### 必須（R-01〜R-04）

| ID | 項目 | 内容 |
|----|------|------|
| R-01 | **いつ（Time Window）** | 通報対象の発生時刻は**瞬間ではなく時間窓**で表現できること（例：直近10分/30分など）。粒度は未決だが"窓"であることは固定 |
| R-02 | **どこ（Coarse Location Cell）** | 通報対象の場所は**点座標ではなく粗位置セル**で表現できること。セルの大きさは未決だが"セル"であることは固定 |
| R-03 | **何（Observation Category）** | 「何を見た/何が起きたか」を、自由記述ではなく**限定カテゴリ**で示せること。自然文は避ける（プライバシーと炎上リスク） |
| R-04 | **通報者責任トークン（Accountability Token）** | 通報者を一般公開しないまま、**後で監査で追える責任トークン**が付くこと（濫用抑止・スパム対策・事後検証） |

##### R-03 カテゴリ（6種類・確定）

過去の事例ベース（消防・救急の受理分類／山岳救助の典型事象）から逆算。「都市災害の型（火災/救急/救助）」＋「山の型（迷い/危険環境）」＋「footprint固有（遭遇カプセル）」で6種類。

| # | カテゴリ名（UI表示） | 含める代表例（抽象） |
|--:|----------------------|----------------------|
| 1 | **医療・救急** | 倒れている／意識なし／重い体調不良／外傷 |
| 2 | **火災・煙・爆発** | 火が出ている／煙が充満／爆発っぽい |
| 3 | **救助（閉じ込め・転落・水難/海難）** | 倒壊・車内/瓦礫に閉じ込め／転落／川に流された／溺れている／船の転覆・落水 など |
| 4 | **遭難・行方不明・迷い** | 山道で戻れない／道迷い／取り残し |
| 5 | **危険環境・二次災害** | 崩落・雪崩・落雷・有毒/ガス臭・強い浸水で接近が危険 など |
| 6 | **遭遇カプセル受領（操作なしrelay）** | 機械的に拾っただけ／内容は読めないが運べる |

**運用メモ**: 日本では海上の事件・事故は118（海上保安庁）、火災・救急・救助は119（消防/救急）。③に水難/海難を含めた上で、将来「推奨連絡先（118/119）」のヒントをUIに載せる拡張が自然（いまはスキーマ非決定のままでOK）。

##### T2 ルーティング（カテゴリ別優先度）

カテゴリ別に「受付起票後の優先度」を固定する。

| 優先度 | カテゴリ | ルーティング |
|--------|----------|--------------|
| **高** | ①医療・救急、②火災・煙・爆発、③救助 | 受付起票後、早い段階で権限救助者レビュー対象 |
| **中** | ④遭難・行方不明・迷い、⑤危険環境・二次災害 | 状況次第（災害モード T3 発動中なら高に昇格） |
| **低** | ⑥遭遇カプセル受領 | 単独では link 起動しない。他の通報と組み合わせて評価 |

**設計根拠**:
- ①②③は「即時性が高い」ため、受付から権限救助者への導線を短くする
- ④⑤は「災害モードかどうか」で優先度が変わる（平時の道迷いと災害時の取り残しは urgency が違う）
- ⑥は「機械的に拾っただけ」なので、単独で link を起動する根拠にはならない。ただし他の通報（①〜⑤）と組み合わせて「最終確認点の補強」として使える

##### 共通ガード（link開始の前提）

link を開始できるのは、カテゴリに関係なく**全部満たす**：

| ID | ガード | 内容 |
|----|--------|------|
| G-01 | **受付起票済み** | T2 は必ず「運用受付（Open Case）」を経由（第三者通報だけで link 開始しない）。T3 でもケースIDは必須（権限救助者が起票して良い） |
| G-02 | **目的限定** | 救助目的のみ（調査・興味本位は禁止） |
| G-03 | **通知＋証跡** | 本人＋プラットフォームへ Notified を満たす（送達キュー永続登録）。満たせないなら link 禁止 |
| G-04 | **失効** | 短TTL＋延長は再承認（"ずっと追える"を作らない） |
| G-05 | **監査強度** | link開始は自動で監査フラグ（必要なら二者承認はカテゴリ側で要求） |

##### 初期ルーティング（カテゴリ×T2/T3）

凡例：
- **許可**: G-01〜05を満たせば開始してよい（既定で開始候補）
- **条件付き**: 追加条件を満たす場合のみ開始（既定は開始しない）
- **禁止**: この入口では link 開始しない（別カテゴリ/別根拠へ誘導）

| R-03カテゴリ（6分類） | T2 通報/捜索起点（受付経由） | T3 災害モード |
|------------------------|------------------------------|---------------|
| ①医療・救急 | **許可（即時開始可）** | **許可（即時開始可）** |
| ②火災・煙・爆発 | **許可（即時開始可）** | **許可（即時開始可）** |
| ③救助（閉じ込め・転落・水難/海難） | **許可（即時開始可）** | **許可（即時開始可）** |
| ④遭難・行方不明・迷い | **条件付き（条件A）** | **条件付き（条件B）** |
| ⑤危険環境・二次災害 | **禁止（人linkより危険情報扱い）** | **禁止（同左）** |
| ⑥遭遇カプセル受領（操作なしrelay） | **条件付き（条件C）** | **条件付き（条件D）** |

##### 条件付きの追加条件

**条件A：カテゴリ④（T2）** — **要求: Strong**
- **信頼者申請** *または* **第三者通報が複数・独立（Strong Independent）**（同時間窓×近傍セルで複数起点）
- かつ **二者承認**（権限救助者内の2名）を要求
- 理由: 道迷い系は誤報/悪用が混ざりやすいので、T2単発での link を抑える。T2は「第三者が入口」になりやすく、誤報・悪用の圧が高い

**条件B：カテゴリ④（T3）** — **要求: Weak→Strong**
- **候補化**: Weak Independent で許可（災害モードでは対象が多く、初動で候補を拾う必要がある）
- **link開始への昇格条件**: **Strong独立ソースがK件揃った時点で昇格**（Kは運用パラメータ）
- 災害モード下で **捜索対象の存在が示唆される根拠**（複数報・継続観測・周辺状況など）がある
- かつ **TTLを短く**（延長は再承認）
- 初期ルーティング: 「Weakでケースを開き、Strongが揃ったらlink開始」の二段階

**条件C：カテゴリ⑥（T2）** — **要求: Strong**
- 原則: **既存ケース（誰かの捜索）への紐付けがある時のみ** link を開始可
- 例外: **複数・独立（Strong Independent）の遭遇カプセル**が同時間窓×近傍セルで集まり、かつ救助価値が高いと受付が判断した場合
- 理由: 遭遇カプセルは"操作ゼロで大量に集められる"可能性があり、単独ソースだと敵対が悪用しやすい

**条件D：カテゴリ⑥（T3）** — **要求: Weak→Strong**
- **候補化（匿名クラスタ）**: Weak Independent で許可（密のノイズをクラスタとして把握する価値がある）
- **link開始への昇格条件**: **Strong独立ソースがK件揃った時点で昇格**（Kは運用パラメータ）
- 災害モード下では、**匿名クラスタとしての候補化（短TTL＋監査フラグ）**を許可
- link開始（同一人物として追う）に踏み込むなら **二者承認** + **Strong** を要求
- 理由: 都心/避難所のノイズを「個人追跡」にせず、救助導線（捜索エリア推定）へ寄せる

##### Weak/Strong 割り当てまとめ

| 条件 | カテゴリ | トリガ | 候補化 | link開始 |
|------|----------|--------|--------|----------|
| A | ④遭難・行方不明・迷い | T2 | — | **Strong** |
| B | ④遭難・行方不明・迷い | T3 | Weak | **Strong** |
| C | ⑥遭遇カプセル受領 | T2 | — | **Strong** |
| D | ⑥遭遇カプセル受領 | T3 | Weak | **Strong** |

##### 「複数・独立」の定義（抽象仕様）

条件A〜Dで出てくる「複数・独立」を定義する。定義は「誰が善意か」ではなく、**「単独の攻撃者が低コストで偽装できないこと」**に寄せる。

###### 用語

| 用語 | 定義 |
|------|------|
| **Report（通報）** | R-01〜R-04（時間窓・粗位置セル・観測カテゴリ・責任トークン）を持つ1件の入力 |
| **責任トークン（AT: Accountability Token）** | 後で監査でき、かつ濫用を抑止できる"非公開の責任紐付け"情報。公開されないが、運用/監査側では「同一主体かどうか」の判定に使える |

###### 「複数（Multiple）」の定義

ある対象クラスタ（同じ時間窓×近傍セル×カテゴリ、またはルーティングで定義する同一事件束）について:

**Multiple = 独立ソースが K 件以上**

K は **運用パラメータ**（数値は未決定、仕様としては "K≥2" の形で置く）

###### 「独立（Independent）」の定義

2つの Report `A` と `B` が **独立**である条件を、**AT（責任トークン）の独立性**で定義する。

| ID | 条件 | 内容 |
|----|------|------|
| I-IND-01 | **ATの発行主体が異なる** | 運用/監査が検証可能な範囲で `A.AT` と `B.AT` が同一主体に紐づかないこと（同一アカウント、同一端末鍵、同一監査ID などに紐づく場合は非独立） |
| I-IND-02 | **レート制限により量産が抑止** | 同一主体から同一（時間窓×近傍セル×カテゴリ）へ、短時間に多数のReportを出しても K を稼げないこと |
| I-IND-03 | **近接整合（coherence）** | `A` と `B` は「同じ事件束」を指すに足る整合がある（同時間窓または隣接窓、同セルまたは隣接セル、同カテゴリまたは同一束にまとめるカテゴリ） |

**重要**: I-IND は「完全なSybil排除」ではなく、**「単独主体の偽装が高コスト/低成功率になる」**ことを仕様上の狙いに置く。

###### 二段階の独立性（強/弱）

| レベル | 条件 | 用途 |
|--------|------|------|
| **弱い独立（Weak Independent）** | I-IND-01 + I-IND-03 | 候補生成、優先度上げに使う（link開始の根拠には単独では使わない） |
| **強い独立（Strong Independent）** | I-IND-01 + I-IND-02 + I-IND-03 | **link開始の根拠に使ってよい**（条件A〜Dの「複数・独立」の意味は基本こちら） |

これにより「第三者通報は受付起票まで／linkは強い独立が必要」という既存方針と整合する。

##### このルーティングで解けること

- **命に直結しやすい ①②③ は "即開始可"** にして初動を落とさない
- **④⑥ は "候補として拾う"はするが、link開始は追加根拠が必要**（敵対の道具化を抑える）
- **⑤ は link で追う対象ではない**（危険情報として扱うのが筋）

##### 任意だが有益（必須にはしない）

| 項目 | 内容 |
|------|------|
| **Confidence（確度）** | 通報者が主観で「確からしさ」を付けられる（救助側の優先順位づけの補助） |
| **Count（件数）** | 同セル同窓で通報が複数あると集約できる（密での畳み込みに効く） |

##### オフライン relay との整合

R-01〜R-04 は、オンライン通報だけでなく**オフラインで"拾って後で運ぶ"**にもそのまま使える。
通報者が操作しない場合は「遭遇カプセル受領」カテゴリとして自動生成し、通信回復時に受付へ流す構造が自然（詳細設計は未決）。

#### EL-Rescue-Boost（T1 がある場合の緩和要因）

T1（本人発SOS）は発動条件ではなく、**緩和要因（ブースト）**として扱う。

| 緩和内容 | 説明 |
|----------|------|
| 優先度を上げる | 救助隊の導線上で上位に出す |
| link の範囲/TTLを緩和 | 少し広げられる（ただし無制限にはしない） |
| ~~二者承認の簡略化~~ | **RISK寄り**。やるなら別途 RISK として合意が必要 |

**重要**: EL-Rescue-02 には「鍵がない孤立者でも成立するトリガ」（T2, T3）を含める。これにより、同意設定がない孤立者も救助可能になる。

### なぜ二系統が必要か

- **信頼者**: 本人の意思で守れる（同意が自然に成り立つ）
- **権限救助者**: 孤立者救助のために、同意だけに寄せると詰む

→ だから "同意の代わりになる客観トリガ" を仕様に置き、濫用は「通知＋証跡＋承認＋失効」で抑える。

---

## 3. "読んだら相手に伝わる"の仕様（通知仕様）

### 3.1 通知対象（誰に届くか）

**reveal（詳細閲覧）が発生したときのみ**通知する。

| 宛先 | 条件 |
|------|------|
| 本人 | 常時通知（オンライン即時／オフライン遅延） |
| プラットフォーム（救助窓口） | 常時通知（オンライン即時／オフライン遅延） |
| 信頼者 | 本人が平時に指定している場合のみ通知 |

※平時に指定していない第三者へ通知が飛ぶのはプライバシー事故になり得るため。

※ **relay / help では通知しない**（疎の「操作なし」価値を守る）。

### 3.2 「通知が相手に伝わった」と見なす条件（Notified）

- **Notified（通知成立）** = 宛先（本人＋プラットフォーム）への通知が、**送達キューに"永続的に"登録された**時点
- 端末が実際に受信・表示した（Delivered）は成立条件ではなく、観測/目盛り仕様（メトリクス）扱い。

#### 永続性（Durability）の定義

**永続的** とは、enqueue が成功を返した通知が **アプリ/OSクラッシュ後の再起動で必ずキューに残っている**（ロストしない）こと。

| 区分 | 内容 |
|------|------|
| **仕様（must）** | クラッシュ復旧性（durability）を満たすこと |
| **実装（自由）** | durability の実現方法（SQLite WAL、追記ログ＋fsync、OSトランザクション等） |

**不変条件 IF-NOTIFIED-001**: Notified の成立には送達キューへの永続登録（クラッシュ復旧可能）が必須である。

**失敗時の挙動**: 永続登録を保証できない場合（例：ストレージ書込不能）は **Notified 不成立** → reveal/link は禁止。

### 3.3 プラットフォーム不在時の扱い

- プラットフォームが不在（通信断・未整備）でも Notified は成立させる必要がある
- "送達キュー"には **ローカル永続Outbox** を含め、オフラインでも「後で送るべき通知」として残ることを成立条件に含める。

### 3.4 通知本文の最小セット（DEC-0005: IF-NOTIFY-CONTENT-001）

通知（Notified）本文に含める最小セットは、**「抑止に十分・悪用に不足」**を満たす次の4点に固定する。

| # | フィールド | 内容 |
|---|-----------|------|
| 1 | **occurred_at** | 発生時刻（UTC, ms, ISO8601 `Z`） |
| 2 | **action_kind** | `REVEAL` / `LINK`（詳細分類は後続で拡張可） |
| 3 | **target_ref** | 対象を示す不透明ID（`case_id` / `candidate_id` / `subject_ref` 等。型は `target_ref` で統一） |
| 4 | **accountability_token** | 後で監査で追える責任トークン（公開しない） |

**明示的に禁止**:
- 閲覧者/実行者の個人情報（氏名・電話・メール・住所・アカウントID・端末ID・IP 等）を含めない
- 痕跡の内容（`payload` / `location` / `state` 等）を含めない
- 精密位置や自由記述を含めない

**不変条件 IF-NOTIFY-CONTENT-001**: 通知本文は `occurred_at` / `action_kind` / `target_ref` / `accountability_token` の4点のみを最小セットとして扱う。閲覧者/実行者の個人情報、痕跡内容、精密位置、自由記述を含めない。

---

## 4. reveal（詳細閲覧）の安全条件

### 4.1 サイレント閲覧は禁止

- reveal は **サイレントに不可能**である（通知が必ず生成される設計）。

### 4.2 Notified を保証できない場合の扱い

- **Notified（送達キューへの永続登録）を保証できない場合、reveal は禁止**
- 例外は通常仕様に混ぜず、必要なら RISK扱いで別途合意する。

---

## 5. サイレント遭遇中継（Silent Encounter Relay）

疎（山道）向けの仕様。

**本仕様の一次証拠はLS（第三者観測ログ）であり、被災者端末の健全性を前提にしない。relay(B)（痕跡データ中継）は上積みであり、成立保証は置かない（特にiOS BGすれ違いに依存しない）。**

### 5.1 基本挙動

- すれ違い＝自動で遭遇記録を"中継"するだけ（第三者は読めない）
- 通行人の端末は「**暗号化された遭遇カプセル**」を生成・保存・転送する
- カプセルは **Authorized Rescue の公開鍵** で暗号化する（IF-CAPSULE-KEY-001 / DEC-0004）
- **通行人はカプセルを復号できない**（読めない）— これが relay の範囲（IF-BOUNDARY-001）
- 救助側/権限者だけが復号し、最終確認点として使える — 復号した瞬間が reveal

### 5.2 被災者側の発信

- 被災者側（端末/タグ）は、**回転する匿名トークン**だけを電波で出す（安定IDを出さない）
- これにより継続追跡（同一人物としてのリンク）を困難にする

### 未決定（OPEN）

- **OPEN-008**: サイレント遭遇中継のスパム対策（PoW/署名/レート制限）

---

## 6. 不変条件（IF）サマリ

この仕様で参照する不変条件の一覧。定義本体は `00_constitution.md` を参照。

| IF | 内容 |
|----|------|
| IF-LOSSLESS-001 | 観測された痕跡は、UI/集約/フィルタの都合で到達不能にしない（ドリルダウン経路を必ず残す） |
| IF-SEARCH-001 | オープン探索→「存在のみ」／対象キー探索→「同一性・特定あり得る」 |
| IF-REVEAL-001 | reveal はサイレントに不可能。閲覧した瞬間に相手へ通知が送達される |
| IF-RELAY-001 | サイレント遭遇中継。すれ違い＝自動で中継、第三者は読めない |
| IF-BOUNDARY-001 | relay と reveal の境界は sealed payload の復号の有無で定義する（DEC-0003） |
| IF-CAPSULE-KEY-001 | 遭遇カプセルの暗号化鍵は Authorized Rescue の公開鍵とする。通行人は復号できない（DEC-0004） |
| IF-NOTIFY-CONTENT-001 | 通知本文は `occurred_at` / `action_kind` / `target_ref` / `accountability_token` の4点のみ。PII・痕跡内容・精密位置・自由記述を含めない（DEC-0005） |

---

## 7. 残OPEN（未決定）一覧

| ID | 内容 | 追跡先 |
|----|------|--------|
| OPEN-001 | オープン探索の「存在」の粒度（エリア？時間窓？） | 本文 Section 1.2, `docs/constitution/80_risks.md` OPEN-001 |
| OPEN-003 | 密/疎の判定方法（自動/手動/状況タグ） | `docs/constitution/80_risks.md` OPEN-003 |
| OPEN-004 | 確度（スコア）の表示上の意味 | `docs/constitution/80_risks.md` OPEN-004 |
| OPEN-005 | オープン探索で履歴/パターン/ベースラインを返すか否か | `docs/constitution/80_risks.md` OPEN-005 |
| ~~OPEN-006~~ | ~~relay と reveal の境界定義（どこまでが relay か）~~ | → DEC-0003 で解決。本文 Section 1.1 に境界定義を追記 |
| ~~OPEN-007~~ | ~~遭遇カプセルの暗号化鍵は誰が持つか~~ | → DEC-0004 で解決。本文 Section 5.1 に暗号化鍵を追記 |
| OPEN-008 | サイレント遭遇中継のスパム対策 | 本文 Section 5, `docs/constitution/80_risks.md` OPEN-008 |
| OPEN-010 | 権限救助者（Authorized Rescue）の定義 | 本文 Section 2, `docs/constitution/80_risks.md` OPEN-010 |
| ~~OPEN-011~~ | ~~通知内容の最小セット~~ | → DEC-0005 で解決。本文 Section 3.4 に通知本文の最小セットを追記 |
| OPEN-012 | プラットフォーム不在/通信断時の T2 補完方法（オフライン relay → 後で受付 等） | 本文 Section 2.1, `docs/constitution/80_risks.md` OPEN-012 |
| OPEN-013 | T3=ONでオープン探索の粒度が変わる場合の影響 | `docs/constitution/80_risks.md` OPEN-013 |

※OPEN-006（relay/reveal 境界）は DEC-0003 で解決済み（Section 1.1 に境界定義を追記）。
※OPEN-007（暗号化鍵）は DEC-0004 で解決済み（Section 5.1 に Authorized Rescue 公開鍵を追記）。
※OPEN-009（link の条件）は Section 2.1 で解決済み。
※OPEN-011（通知内容の最小セット）は DEC-0005 で解決済み（Section 3.4 に通知本文の最小セットを追記）。
※全OPEN一覧の索引は `docs/constitution/10_core_fact_spec.md` の OPEN Index と `docs/constitution/80_risks.md` を参照。

---

## 8. 関連ドキュメント

- `00_constitution.md` — 運用原則・不変条件の定義
- `10_core_fact_spec.md` — L0（Core Fact）データモデル
- `20_share_envelope_spec.md` — L1（Share Envelope）転送仕様
- `80_risks.md` — 懸念事項・RISK・OPEN の管理
