# 懸念事項リスト（docs/constitution/80_risks.md）

懸念事項の管理ファイル。不変条件（IF）は `docs/constitution/` を参照。

---

## 懸念事項

### C-001 密集地で痕跡がノイズ化して役に立たない

* **懸念**: 人が多い場所（避難所・都市部）では痕跡が過多になり、現場で使えない。
* **致命化条件**:
  * 「周辺の痕跡をそのまま一覧」しかできない
  * 自動フィルタで落とす（取りこぼし） or UIが破綻する
* **解決案（方向性）**:
  * **"消さずに畳む"**: 全件到達可能を保ったまま、要約/順位付け/クラスタで表示を縮退（ドリルダウン必須）
  * **縮退モードの明文化**: 密では「上位N＋要約」になるが、ロスレス経路は残す
* **前提**: IF-LOSSLESS-001
* **案無し（不可能領域）**: 密集地で「生痕跡を全部わかりやすく同時表示」すること自体は現実的に無理

---

### C-002 抽象的な挙動仕様が未定義（寄り分けの定義がない）

* **懸念**: 「雑多なノイズの中から被災者をどう寄り分けるか」が定義できていない。
* **解決案（方向性）**: 寄り分けを一枚岩にせず **モード分離**する
  * **対象キー探索**: 確定対象を追う（高精度・高速）→ **同一性・特定あり得る**
  * **オープン探索**: キー無しで候補を拾う → **「存在のみ」（同一性に至らない）**
* **前提**: IF-SEARCH-001
* **OPEN**:
  * オープン探索の「存在」の粒度（エリア？時間窓？）
  * 候補生成の根拠への到達経路

---

### C-003 「取りこぼしゼロ」をどう定義するか（死に直結する恐れ）

* **懸念**: 「取りこぼし＝死」になり得るので、仕様として厳密に定義したいが難しい。
* **重要な整理**:
  * **不可能**: 現実の被災者全体に対して"取りこぼしゼロ"（痕跡がそもそも無いケースがある）
  * **仕様化可能**: **観測された痕跡に対して"取りこぼしゼロ"**
* **解決案（方向性）**: IF-LOSSLESS-001 として不変条件化済み

---

### C-004 対象キーに寄せると、一人暮らし等の孤立者が見えない

* **懸念**: 家族共有や救助IDが前提だと、孤立者を"見えない設計"にしてしまう。
* **解決案（方向性）**: **対象キー探索だけにしない**（C-002の二段構えで受ける）
  * オープン探索で「存在」を拾える余地を残す
  * ただし「存在のみ」なので、孤立者の**特定**はオープン探索だけでは不可能
* **前提**: IF-SEARCH-001
* **解決済み**: ~~OPEN-002~~ → `15_behavior_spec.md` Section 2.1 (T2詳細仕様) で昇格パスを定義

---

### C-005 疎の状況では「無関係な第三者が通る」ことが価値になる

* **懸念**: 密ではノイズでも、疎では第三者の通過・中継が救助の入口になり得る。
* **解決案（方向性）**: オープン探索の価値を **疎で最大化**し、密では **縮退**する
  * 同じ機能を一律にせず、環境（密/疎）でUI/提示を変える（ただしロスレス経路は不変）
  * **IF-RELAY-001**: 疎ではサイレント遭遇中継を活用（すれ違いだけで最終位置が残る）
    * 注: Find My / Find Hub 互換タグは (A)位置relay を強化するが、(B)痕跡データrelay（遭遇カプセルの store-carry-forward）そのものにはなれない
* **前提**: IF-LOSSLESS-001, IF-RELAY-001
* **OPEN**: 密/疎の判定をどう扱うか（自動/手動/状況タグ）

---

### C-006 プライバシー・悪用（オープン探索ほど現実化しやすい）

* **懸念（具体例）**:
  * ストーキング/DV（避難先・生活圏推定）
  * 空き巣（不在推定）
  * 失踪者/未成年等の所在暴露
  * 善意の誤特定→拡散→炎上/現場混乱
  * 詐欺（"痕跡が見えた"を材料に社会工学）
  * 救助妨害（偽情報・誘導）
* **解決案（方向性）**:
  * **IF-SEARCH-001 を前提として採用**: オープン探索は「存在のみ」、同一性・特定は対象キー探索のみ
  * これにより、オープン探索経由での悪用シナリオ（ストーキング等）の**直接的な成立を阻止**
  * 対象キー探索は「キー保持者のみ」なので、悪用には「キーの不正取得」が必要（別の防御層）
  * **IF-REVEAL-001**: 詳細閲覧（reveal）はサイレントに不可能
    * 閲覧が発生した瞬間、相手（本人＋指定連絡先/救助窓口）へ通知が送達される
    * オンラインなら即時、オフラインなら遅延送達（通知は必ず生成され、送達キューに残る）
    * relay（中継）＝誰でもできる（通知不要）
    * reveal（詳細）＝必ず通知が出る（敵対の"こっそり不在確認"を潰す）
    * 通知内容は DEC-0005 の最小4点（`occurred_at` / `action_kind` / `target_ref` / `accountability_token`）に固定し、PII・痕跡内容・精密位置・自由記述を含めない
* **前提**: IF-SEARCH-001, IF-REVEAL-001, IF-NOTIFIED-001
* **残存リスク**:
  * 「存在のみ」でも、時空間粒度が細かすぎると推定可能になる（→ RISK-PRIV-001）
  * **「不在」の推定は「存在のみ」でも防げない**（空き巣等）
    * 「この場所に痕跡が無い」＝「不在の可能性が高い」は同一性不要で成立
    * 対策: オープン探索は履歴/パターン/ベースラインを返さない + 粒度下限を設ける
  * キーの不正取得・漏洩（対象キー探索の悪用）
  * 権限を持つ救助者の悪用（内部犯行）

---

### C-007 （派生）オープン探索が"候補"を増やしすぎて現場負荷・誤報を増やす

* **懸念**: 取りこぼし恐怖で候補を広げるほど、救助リソースが吸われる/混乱する。
* **解決案（方向性）**:
  * 候補は消さないが **順位付けとクラスタリングで"当たり先"を提示**（＝作業導線を作る）
  * "候補の確度"を明示し、運用上の期待値を壊さない
* **前提**: IF-LOSSLESS-001
* **OPEN**: 確度（スコア）の意味をどう定義するか（アルゴリズムの話ではなく「表示上の意味」）

---

### C-008 疎での"サイレント遭遇中継"は、存在漏れ・スパム・鍵運用が難所

* **懸念**: 山道等の疎環境で「すれ違いだけで最終位置が残る」を実現するには、サイレント遭遇中継（IF-RELAY-001）が必要だが、新たな難所が生まれる。
* **難所（具体）**:
  * **存在漏れ**: 電波を拾える＝近くに誰かいる、は残る（ただし"誰か/どこに住む/不在"は作りにくい）
  * **スパム/偽カプセル**: 悪意で大量投入される可能性
  * **鍵運用**: 誰の鍵で暗号化するか（救助機関鍵/地域鍵/家族鍵）で、復号可能者が変わる
* **解決案（方向性）**:
  * 存在漏れ: 回転トークン＋粗粒度で"誰か"の特定を困難にする
  * スパム: カプセル生成に軽い PoW（Proof of Work）または署名を要求（→ OPEN）
  * 鍵運用: 鍵クラスは DEC-0004 で決定済み（Authorized Rescue 公開鍵）。運用主体定義は OPEN-010 で継続
* **前提**: IF-RELAY-001
* **OPEN**: スパム対策の具体手段（OPEN-008）、運用主体定義（OPEN-010）

---

## RISK（停止が必要な危険領域）

### RISK-PRIV-001: オープン探索の粒度が細かすぎると同一性推定が可能になる

* **影響**: IF-SEARCH-001 の「存在のみ」が実質的に破れ、悪用シナリオが現実化
* **対策方針**: 粒度の下限を設計時に決定
* **人間判断必須**: プライバシー重大影響のため、設計確定前に mini RFC 必須

---

### RISK-BLE-IOS-001: iOS BLE制約により「操作ゼロの痕跡/中継」をスマホ単体で保証できない

#### 概要

日本ではiOS比率が高く、iOSユーザーだから機能品質が下がる（=死にやすい）設計は許容しづらい。一方で、iOSはBLE（発見/広告/バックグラウンド動作）に実用上の制約があり、被災者が操作不能な状況（生き埋め等）で、スマホ単体の近接中継・メッシュ前提は成立しない恐れがある。

#### 想定ユースケース影響

* 生き埋め・気絶・端末破損・電池切れ等で「アプリを開く/操作する」前提が成立しない。
* 疎（山道/海辺等）で「通りすがりとのすれ違いだけで最終位置の手がかりが残る」価値を、iOSだけ担保できない可能性。
* 密（都市災害）でもバックグラウンド制約により、近接交換の成立率/タイミングが読めず、設計上の保証が置きにくい。

#### リスク内容（技術・運用）

* iOSはバックグラウンドでのBLEスキャン/広告が制限・間引き・遅延し得るため、
  「常時・自動・オフライン中継ノード」をスマホ（特にiOS）に期待すると不確実性が高い。
* Foreground（アプリが開いている）を前提にしたP2P強化は可能だが、被災者が操作不能なケースを救えない。
* 端末組み合わせ（iOS-iOS / iOS-Android / Android-Android）で通信手段を切り替えても、
  "操作ゼロ"かつ"常時性"をスマホ単体で保証する課題は残り得る。

#### 影響（Outcome）

* iOSユーザーが相対的に痕跡が残りにくい／中継されにくい場合、救命機会に偏りが生じる（公平性・受容性の問題）。
* 仕様上「必ず残る」と言えない領域が増え、プロダクトの約束（救助の手がかりを残す）と矛盾する恐れ。

#### 既存サービス比較（成立条件の置き方）

既存サービスは「アプリ単体BLE常時中継」を保証に置かず、成立条件を別レイヤへ逃がしている。

| カテゴリ | サービス | 成立条件の置き方 |
|----------|----------|------------------|
| OS組み込み群衆NW | Apple「探す」 | 周囲のApple端末がBLE信号を検出→暗号化した位置を中継する"OS組み込み"の群衆ネットワーク前提。アプリ層ではなくOS層で常時性を担保。 |
| プラットフォーム群衆NW | Google Find Hub | 参加端末が暗号化された位置情報を収集/保存/中継する"プラットフォーム側"の群衆ネットワーク前提。 |
| アプリ層BLE | iOS CoreBluetooth | 前景のみアプリはBGでscan/advertise不可。BGモードでもscan間隔増・advertise頻度低下等が明示され、タイミング/成立率の保証を置きにくい。 |
| 登山ログ系 | YAMAP / ヤマレコ | 圏外でもGPSログは取れるが「事前DL」「活動開始」などユーザー起動の運用で成立させる（操作不能は守備範囲外になりがち）。 |
| 遭難捜索系 | ココヘリ / DRS / HITOCOCO | 端末OSに依存せず、専用発信機（特定小電力/救助周波数等）＋直接通信/受信で成立条件を担保する。 |

**示唆**: 「操作ゼロ＋常時性」を保証するサービスは、いずれもアプリ単体BLEに依存していない。OS組み込み（Apple/Google）か、専用ハードウェア（ココヘリ等）に成立条件を移している。footprint がアプリ層のみで同等の保証を置こうとすると、上記いずれの先行事例とも異なる未踏領域に踏み込むことになる。

注: Find My / Find Hub 互換タグは「位置relay(A)（最小の手がかり/MEE）」を強化するものであり、relay(B)（遭遇カプセル等の痕跡データ store-carry-forward 中継）そのものにはならない（参考: docs/backlog/research-minimum-external-evidence.md）。

#### 未解決点（TODOではなく論点）

* iOS制約下で「被災者操作ゼロ」を満たす通信・中継の成立条件をどこに置くか（スマホ単体に置けない可能性を含む）。
* "保証"と"ベストエフォート"の境界（どこまでを要件、どこからを期待値にするか）。

* **関連**: C-005（疎での価値）, C-008（サイレント遭遇中継の難所）, IF-RELAY-001, OPEN-012
* **人間判断必須**: iOS/Android公平性は製品の根幹に関わるため、設計確定前に方針合意必須

---

### RISK-OPS-USE-001: 情報が救助意思決定を変えず、現場で使われない

* **概要**: 取得・提示できる情報があっても、探索開始点/優先度/範囲が変わらず「無くても同じ」扱いになると、現場で参照されない恐れがある。
* **影響**: 導入しても救命効果に結びつかず、運用に組み込まれない（実効性の欠落）。

---

## OPEN（未解決の設計判断）

- 索引（SSOT）: `docs/constitution/10_core_fact_spec.md` の OPEN Index
- 挙動仕様の関連箇所: `docs/constitution/15_behavior_spec.md` Section 7

| ID | 内容 | 関連懸念 | 状態 |
|----|------|----------|------|
| OPEN-001 | オープン探索の「存在」の粒度（エリア？時間窓？） | C-002, C-006 | 未解決 |
| OPEN-003 | 密/疎の判定方法（自動/手動/状況タグ） | C-005 | 未解決 |
| OPEN-004 | 確度（スコア）の表示上の意味 | C-007 | 未解決 |
| OPEN-005 | オープン探索で履歴/パターン/ベースラインを返すか否か | C-006 | 未解決 |
| ~~OPEN-006~~ | ~~relay(B:痕跡データrelay) と reveal の境界定義（どこまでが relay(B) か）~~ | C-006 | **解決済み** → DEC-0003 |
| ~~OPEN-007~~ | ~~遭遇カプセルの暗号化鍵は誰が持つか（救助機関鍵/地域鍵/家族鍵）~~ | C-008 | **解決済み** → DEC-0004 |
| OPEN-008 | サイレント遭遇中継のスパム対策（PoW/署名/レート制限） | C-008 | 未解決 |
| OPEN-010 | 権限救助者（Authorized Rescue）の定義（組織・運用主体） | C-006 | 未解決 |
| ~~OPEN-011~~ | ~~通知内容の最小セット（抑止に十分・悪用に不足）~~ | C-006 | **解決済み** → DEC-0005（通知最小4点 + 禁止事項） |
| OPEN-012 | プラットフォーム不在/通信断時の T2 補完方法（オフライン relay → 後で受付 等） | C-004, C-008 | 未解決 |
| OPEN-013 | T3=ONでオープン探索の粒度が変わる場合の影響（プライバシー臨界点との関係） | RFC-0001, RISK-PRIV-001 | 未解決 |

---

## 解決済みOPEN

| ID | 内容 | 解決先 |
|----|------|--------|
| OPEN-002 | 「存在」から「特定」への昇格パス（誰が/どの権限で/どの手続きで） | `15_behavior_spec.md` Section 2.1 (T2詳細仕様) |
| OPEN-006 | relay(B:痕跡データrelay) と reveal の境界定義（どこまでが relay(B) か） | DEC-0003 → `15_behavior_spec.md` Section 1.1, `20_share_envelope_spec.md` Envelope 構造 |
| OPEN-007 | 遭遇カプセルの暗号化鍵は誰が持つか | DEC-0004 → `15_behavior_spec.md` Section 5.1, `20_share_envelope_spec.md` sealed payload |
| OPEN-009 | link（同一人物追跡）の「条件付き」の条件（信頼者・権限救助者それぞれ） | `15_behavior_spec.md` Section 2.1 |
| OPEN-011 | 通知内容の最小セット（抑止に十分・悪用に不足） | DEC-0005（`docs/rfc/DEC-0005-notification-minimal-set.md`）→ `15_behavior_spec.md` Section 3.4, `20_share_envelope_spec.md` Notification Reference |

---

## 暫定まとめ（合意候補）— 挙動原則

1. **寄り分けは「除外」ではなく「整理」**（消さずに畳む）
2. **取りこぼしゼロは「観測された痕跡が到達不能にならない」意味で定義**（IF-LOSSLESS-001）
3. **探索は二段構え**: 対象キー探索（確定）＋オープン探索（候補生成）
4. **悪用防止の臨界点**（IF-SEARCH-001）:
   * オープン探索 → 「存在のみ」
   * 対象キー探索 → 「同一性・特定あり得る」
5. **詳細閲覧はサイレントに不可能**（IF-REVEAL-001, IF-NOTIFIED-001）:
   * 用語分離: relay は (A)位置relay と (B)痕跡データrelay を区別する（以後、relay/reveal 境界の「relay」は(B)を指す）
   * (A)位置relay: OS組み込みネットワーク（例: Find My/Find Hub）で「タグ/端末の位置」が更新・共有される類。footprint の遭遇カプセル転送ではない
   * relay(B:痕跡データrelay)（中継）＝誰でもできる（通知不要）
   * reveal（詳細）＝閲覧した瞬間に相手へ通知が送達される（オンライン即時／オフライン遅延）
   * 抑止の芯は「ログが残る」ではなく「相手に伝わる」
   * 通知の送達保証は「送達キューへの永続登録（クラッシュ復旧可能）」で担保（IF-NOTIFIED-001）
6. **疎ではサイレント遭遇中継**（IF-RELAY-001）:
   * すれ違い＝自動で遭遇記録を"中継"するだけ（第三者は読めない）
   * 通行人は暗号化カプセルを生成・保存・転送するが、復号できない
   * 救助側/権限者だけが復号し、最終確認点として使える
7. **密では縮退、疎では価値が出る**（ただしロスレス経路は不変）
8. **最大の難所はプライバシー/悪用耐性**（RISK-PRIV-001 として管理）
9. **iOS BLE制約により「操作ゼロ中継」をスマホ単体で保証できない**（RISK-BLE-IOS-001 として管理）
