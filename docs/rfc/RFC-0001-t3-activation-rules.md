# RFC-0001: T3（災害モード）発動ルール

## Status
Accepted
Owner: SR (human)
Date: 2026-02-01

## Context

T3（災害モード）は、通常運用から災害時運用へ挙動を切り替えるためのトリガーである。
災害時は通信断・混乱で「自動だけ」は欠落しやすく、逆に「手動だけ」は押せないケースがある。

### 3つのシグナル源の役割整理

| シグナル源 | 役割 | 強み | 弱み |
|------------|------|------|------|
| 手動フラグ | 最後の確定手段（いつでも使える） | オフラインでも確実／実装が堅い／誤検知の説明が容易 | 本人が押せない状況がある（負傷・端末破損・混乱） |
| 公的アラート（自治体/公的機関/OS緊急速報） | 自動ONを正当化できる根拠 | 誤検知しにくい／救助側に説明しやすい | 通信・API・提供形態に依存（災害時ほど取りにくい場合がある） |
| エリア自動判別 | 補助シグナル | 通信断・公的アラート未到達時の補完 | 誤検知しやすい（端末状況ヒューリスティックの限界） |

## Goal

- T3発動の「優先順位」「確定/推奨の分離」「TTL」をSSOT化する
- 救助価値と誤作動耐性のバランスを取る
- risks.md の懸念（C-006, RISK-PRIV-001）と整合させる

## Non-goals

- T3発動後の具体的な挙動変更（別RFCで扱う）
- 公的アラートAPIの具体的な実装方式
- UI/UXの詳細設計

## Proposal (Minimal Diff)

### 1. T3状態の分離（確定/推奨）

| 状態 | 意味 | 挙動 |
|------|------|------|
| T3=OFF | 平時 | 通常運用 |
| T3=RECOMMENDED | T3推奨 | UI通知・省電力準備のみ。本格的な挙動変更は行わない。ユーザ操作が可能なら確定を促す |
| T3=ON | T3確定 | 災害モード挙動に本格切替 |

**設計意図**: 「誤検知しても致命傷にならない」設計。プライバシーや電池を守りつつ、切替の機会を増やす。

### 2. 発動優先順位（上ほど強い）

| 優先度 | トリガー | 結果 | 備考 |
|--------|----------|------|------|
| 1 | 手動フラグ | T3=ON（即確定） | 最優先。議論の余地が少ない |
| 2 | 公的アラート受信/取得（該当エリア内） | T3=ON | 公的情報は自動ONの根拠として十分 |
| 3 | エリア自動判別（公的アラート由来のジオフェンス） | T3=ON | 2と同等。根拠が公的なら強い |
| 4 | 端末状況ヒューリスティック（通信断/停電っぽさ等） | T3=RECOMMENDED | 単独確定しない。補助シグナルとして推奨のみ |

**IF-T3-001**: 手動フラグは最上位の確定トリガとして固定する。
**IF-T3-002**: 公的アラートを取得できた場合のみ自動ONを許可する（必須依存にはしない）。
**IF-T3-003**: 端末状況ヒューリスティック単独ではT3=ONにしない（推奨のみ）。

### 3. TTL（Time-To-Live）

| 起動元 | TTL | 延長/終了 |
|--------|-----|-----------|
| 手動起動 | 無期限（手動解除が基本） | 誤操作対策として「一定時間後に確認」通知を出す |
| 公的アラート起動 | 6〜24時間（設定可能） | アラート更新で自動延長。更新なしで自動失効 |
| 端末ヒューリスティック起動（RECOMMENDED） | 1〜2時間（設定可能） | 状況改善（通信復帰等）で自動解除 |

**IF-T3-004**: 自動ONは永遠に残らない。TTLで自動延長/自動失効する。

### 4. エリア自動判別の2種類

| 種類 | 定義 | 扱い |
|------|------|------|
| (A) 公的アラートのエリアに基づく判別（ジオフェンス） | 公的アラートが発令されたエリアに端末が存在するかを判定 | 実質「公的アラート連携」の一部。T3=ON可 |
| (B) 端末状況に基づく判別（通信断/停電っぽさ等） | 通信状態・電源状態等から災害状況を推定 | 誤検知しやすい。T3=RECOMMENDED のみ |

## Impact on SSOT

- Constitution: No change
- Core Fact Spec: **Change** — T3発動ルールセクションを追加
- Share Envelope Spec: No change

## Safety Check (Must)

- No guessing introduced: **Yes** — 端末ヒューリスティックは「推奨」に留め、確定には使わない
- No claiming introduced: **Yes** — 公的アラートのみが自動確定の根拠
- Blank remains explicit: **Yes** — T3状態は明示的に管理

## Acceptance Criteria

- AC1: 手動フラグでT3=ONになること
- AC2: 公的アラート受信でT3=ONになること（エリア内の場合）
- AC3: 端末ヒューリスティック単独ではT3=RECOMMENDEDになり、T3=ONにならないこと
- AC4: 公的アラート起動のT3はTTL経過後に自動失効すること
- AC5: 手動起動のT3は手動解除が必要なこと

## risks.md との整合

- **C-006（プライバシー・悪用）**: T3の挙動自体を「侵襲度が上がりすぎない」ように分離（確定/推奨、T3-low等）することで、発動条件を厳しくしても守り切れない問題を緩和
- **RISK-PRIV-001**: T3=ONでオープン探索の粒度が変わる場合、その影響は別途検討が必要（OPEN-013として追加）

## 関連

- OPEN-003: 密/疎の判定方法（T3発動と連動する可能性あり）
- OPEN-012: プラットフォーム不在/通信断時の補完方法

## 決定

DEC-0001 として採用。10_core_fact_spec.md に反映する。
